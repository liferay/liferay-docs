<?xml version="1.0"?> 

<project name="Markdown Document Conversion" default="echo-props" basedir=".">
	<property name="project.dir" value="../.." />

	<path id="lib.classpath">
		<fileset dir="${basedir}/lib" includes="*.jar" />
		<fileset dir="${basedir}/code/liferay-doc-utils/lib" includes="*.jar" />
	</path>

	<path id="project.classpath">
		<pathelement path="${classpath}" />
		<path refid="lib.classpath" />
	</path>
	
	<property name="build.dir" value="./build"/>
    <property name="pandoc.app" location="/home/${user.name}/.cabal/bin/pandoc"/>
	
    <target name="prepare" description="creates build directory">
        <echo message="... creating build directory"/>
        <mkdir dir="${project.dir}/${page.dir}/${doc.dir}/${build.dir}"/>
		<touch file="${project.dir}/${page.dir}/${doc.dir}/${build.dir}/${article}.html" mkdirs="true"/>
		<mkdir dir="${build.dir}/images"/>
        <copy todir="${build.dir}/images" overwrite="true">
            <fileset dir="./images"/>
        </copy>
    </target>

	<target name="article-to-html" depends="prepare" description="converts single markdown article to an html file">
        <echo message="... converting ${article} to html"/>
        <!-- pandoc -f markdown -t html -o 01-introduction-to-liferay-ui.html 01-introduction-to-liferay-ui.markdown -->
		<exec executable="${pandoc.app}" dir="${build.dir}">
            <arg value="-f" />
            <arg value="markdown"/>
            <arg value="-t"/>
            <arg value="html"/>
            <arg value="-smart"/>
            <arg value="-o"/>
            <arg value="${project.dir}/${page.dir}/${doc.dir}/${build.dir}/${article}.html"/>
            <arg value="${article}"/>
        </exec>
    </target>
	
	<target name="article-to-html-win" depends="prepare" description="converts single markdown article to an html file on windows">
        <echo message="... converting ${article} to html"/>
        <!-- pandoc -f markdown -t html -o 01-introduction-to-liferay-ui.html 01-introduction-to-liferay-ui.markdown -->
		<exec executable="cmd">
            <arg value="/C" />
            <arg value="pandoc"/>
            <arg value="-f" />
            <arg value="markdown"/>
            <arg value="-t"/>
            <arg value="html"/>
            <arg value="-smart"/>
            <arg value="-o"/>
            <arg value="${project.dir}/${page.dir}/${doc.dir}/${build.dir}/${article}.html"/>
            <arg value="${article}"/>
        </exec>
    </target>

</project>