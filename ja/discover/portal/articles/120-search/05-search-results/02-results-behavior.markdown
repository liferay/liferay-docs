---
header-id: search-results-behavior
---

# 検索結果の動作

[TOC levels=1-4]

前の記事では、検索結果を表示する方法について説明しました。 この記事では、これらの追加の検索結果の概念と構成について説明します。

  - [ファセットによる検索結果のフィルタリング](#filtering-results-with-facets)
  - [検索結果の関連性を理解する](#search-results-relevance)
  - [アクセス許可が検索結果に与える影響](#permissions-and-search-results)
  - [ステージング環境での検索結果](#search-and-staging)
  - [検索結果の概要](#result-summaries)
  - [検索結果の用語の強調表示](#highlighting)

## ファセットによる結果のフィルタリング

結果は *ファセット*を使用してフィルタリングされます。 ほとんどのユーザーは、特に商取引活動中に、他のアプリケーションで同様のフィルタリング機能に遭遇しています。 ユーザーが検索用語を入力すると、結果と検索ファセットのリストが表示されます。これは、共通の特性を共有する場合に結果をグループ化するバケットと考えることができます。

管理者はファセットを構成できます。 詳細については、 [ファセットの構成](/docs/7-1/user/-/knowledge_base/u/facets) をお読みください。

## 検索結果の関連性

検索エンジンは、関連性 *の概念*を使用して、リストの上部に表示される結果を決定します。 関連性は、検索エンジンによって計算されたスコアです。 返されるドキュメントの合計スコアに影響を与える要因は数多くあります。関連性スコアリングがどのように機能するかの実装の詳細はすべて、 [検索エンジン](https://www.elastic.co/guide/en/elasticsearch/guide/current/relevance-intro.html#relevance-intro)によって提供されるアルゴリズムです。

## 権限と検索結果

アセットに対する [権限](/docs/7-1/user/-/knowledge_base/u/roles-and-permissions) を持たないユーザーは、検索結果にそれを表示しません。 サイト管理者の役割を持つログインユーザーは、サイトのゲストユーザーよりも多くの検索結果を表示する可能性があります。

バックグラウンドでは、2つのラウンドの権限チェックがあります。 最初の権限チェック、 *事前フィルタリング*は、検索エンジンのインデックスで行われます。 データベースのアクセス許可情報を確認するよりも高速ですが、検索インデックスに古いアクセス許可情報が含まれることがあります。 検索エンジンのインデックスに正しい最新の権限情報があることを確認するために、最後の2番目の権限チェック、 *ポストフィルタリング*が、結果の表示前に結果に対して実行されます。

### 初期権限チェック

検索結果の権限フィルタリングの最初のラウンドでは、検索クエリにフィルター句を追加します。 これにより、現在のユーザーが表示できる結果を含む、事前にフィルタリングされた検索エンジンからの結果が確実に返されます。

この初期権限チェックは、 *コントロールパネル* → *設定* → *システム設定* → *検索* → *権限チェッカー*ます。 検索がユーザー権限を処理する方法を構成する2つのシステムレベル設定が含まれています。

**継承されたアクセス許可を含める** ：この設定を無視します。 これは非推奨であり、どこでも使用されておらず、将来のリリースで削除される予定です。

**権限期間制限** ：このレベルの権限チェックが中止される前に、検索クエリに追加される権限検索句の数を制限します。 権限チェックは、以下で説明する最終的な権限フィルタリングのみに依存します。

権限の条件を制限する唯一の理由はパフォーマンスです。 多くのサイトや組織への管理アクセス権を持つユーザーは、クエリに追加された多くの権限条件を生成します。 クエリ内の用語が多すぎると、検索エンジンがタイムアウトする可能性があります。

### 最終的な権限チェック

UIに結果を表示する前に、権限チェックの最後のラウンドが行われます。 たとえば、ユーザーが *liferay*検索すると、検索エンジンは関連するすべてのフォーラム投稿を返します。 検索結果は関連するフォーラム投稿のリストを反復処理するため、最後の権限チェックを実行して、ユーザーが投稿とそのカテゴリを表示できるようにします。 一致するフォーラム投稿が、ユーザーが表示する権限を持っていないカテゴリに存在する場合、検索結果のリストには表示されません。

この最後の権限チェックは、 *コントロールパネル* → *設定* → *システム設定* → *検索* → *デフォルトの検索結果権限フィルター*ます。 次の2つの設定が含まれます。

1.  最初の設定、Permission Filtered Search Result Accurate Count Thresholdは、結果がカウントされる前に、permissions-filterに検索結果の最大数を指定します。 しきい値を高くすると、カウントの精度は向上しますが、パフォーマンスは低下します。 現在表示されているページの結果は常にチェックされるため、検索結果のページ分割デルタよりも小さい値を指定すると、この動作が事実上無効になります。

2.  2番目の設定である[検索クエリ結果ウィンドウの制限]は、各権限チェック要求の最大バッチサイズを設定します。 <!-- OR limits the number of
    results to include in each permission checked request/response cycle to and
    from the search engine--> 。 これも改ページ調整の影響を受けます。 たとえば、ページごとに100の結果があり、ユーザーが検索結果の200ページにジャンプしたい場合、ユーザーに権限があることを確認するために、1ページと200ページの間のすべての結果を確認する必要があります。 権限チェックの結果は20,000です。 これを1回の旅行で実行して検索エンジンを形成すると、パフォーマンスの問題が発生する可能性があります。 各権限チェックリクエストの最大バッチサイズを設定します。

## 検索とステージング

[ステージング](/docs/7-1/user/-/knowledge_base/u/staging-content-for-publication)場合、コンテンツはプレビューおよびテスト環境に最初に配置されてから、エンドユーザーによる使用のために公開されます（ライブサイト上）。 検索インデックスに追加されたコンテンツはマークされているため、検索APIはアイテムがライブかどうかを判別できます。 サイトのライブバージョンでは、ライブサイト用にマークされたコンテンツのみが検索可能です。

サイトの段階的バージョンでは、すべてのコンテンツ（ライブまたは段階的）が検索可能です。

## 結果の要約

結果の概要には、アセットの開発者がアセットを検索するエンドユーザーにとって最も有用であると感じたドキュメントの情報が含まれます。 各アセットには、要約に含まれる異なるフィールドを含めることができます。 テキストコンテンツと資産について、共通の要約フォーマットは、 *タイトル* の一部 *含量*タイトルは、最初に表示されます。 アセットタイプは常に2行目に表示され、検索語に一致するコンテンツのスニペットは最後の行に表示されます。 ドキュメントやメディアドキュメントなど、コンテンツフィールドのないアセットは、代わりに説明を表示します。

ユーザーは異なります。 ユーザーの概要に表示されるのは、ユーザーのフルネームとアセットタイプ（ユーザー）のみです。

![図1：ユーザーの概要には、ユーザーのフルネームのみが含まれます。](../../../images/search-results-user.png)

他のアセット（Web Content、Documents & Media、およびBookmarksフォルダー）を含むアセット、またはコンテンツを表示できない（ダイナミックデータリストレコードとカレンダーイベント）アセットの場合、タイトル、アセットタイプ、および説明を表示する方が理にかなっています。結果の要約。 これらのアセットのコンテンツフィールドには何もありません。

![図2：Documents and Media、Web Content、およびBookmarksフォルダーには、概要にタイトルと説明が含まれています。](../../../images/search-results-folder.png)

ブックマークエントリには、タイトルとURLが表示されます。

![図3：ブックマークエントリの概要には、タイトルとURLが表示されます。](../../../images/search-results-bookmark.png)

アセット開発者はどのフィールドが集計可能かを決定しますが、表示する集計フィールドの部分を正確に決定するロジックが検索時に呼び出されます。 たとえば、 `コンテンツ` フィールドには多くのテキストを含めることができますが、要約にはすべてが表示されません。 代わりに、フィールドのテキストの関連するスニペットが表示されます。 検索されたキーワードが要約フィールドに存在する場合、フィールドのその部分が要約で使用されます。 さらに、一致するキーワードが要約で強調表示されます。

## ハイライト

今では、おそらく概要に表示される検索語がされていることに気付きました <mark>強調表示</mark> デフォルトで。 これが望ましくない場合は、ウィジェット構成画面で無効にしてください。

![図4：一部のドキュメントの要約には、検索用語が要約に表示されるテキストと一致する場合、多くのハイライトがあります。](../../../images/search-results-highlight.png)

強調表示は、結果が返される理由を示す便利な視覚的手掛かりですが、注意してください。 ヒットは適切にスコアリングできるため、サマリーにハイライトを表示することなく、結果の上部に戻ることができます。 これは、すべてのインデックス付きフィールドが要約に表示されるわけではないためです。 Arthur C. Clarkeという名前のユーザーについて考えます。 彼のメールアドレスは *<acc@authors.org>*、検索可能です。 ユーザーの結果の要約にはユーザーのフルネームのみが含まれるため、メールアドレスでクラーク氏を検索するとユーザーが返されますが、強調表示されている用語はありません。

![図5：検索語に一致する結果には、常にハイライトが表示されるとは限りません。](../../../images/search-results-no-highlight.png)

検索結果にハイライトが表示されない場合もあります。
